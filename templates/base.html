<!DOCTYPE html>
<html lang="{{ DEFAULT_LANG }}">
<head>
    {% block head %}
    <title>{% if article %}{{ article.title }} | {% elif page %}{{ page.title }} | {% endif %} {{ AUTHOR }}</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Pelican" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="{{ AUTHOR }}" />
    <meta name="theme-color" content="#11191f">
    {% if article and article.summary %}
    {% set _raw_meta = article.summary %}
    {% elif page and page.summary %}
    {% set _raw_meta = page.summary %}
    {% else %}
    {% set _raw_meta = DESCRIPTION %}
    {% endif %}
    {% set meta_description = _raw_meta|striptags|truncate(160) %}
    {% set meta_description_long = _raw_meta|striptags|truncate(200) %}

    <meta name="description" content="{{ meta_description }}" />
    {% if article and article.keywords %}
    <meta name="keywords" content="{{ article.keywords }}" />
    {% endif %}
    {% if article and article.summary %}
    <meta name="summary" content="{{ meta_description_long }}" />
    {% endif %}

    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="{% if article %}article{% else %}website{% endif %}" />
    <meta property="og:title" content="{% if article %}{{ article.title }}{% elif page %}{{ page.title }}{% else %}{{ SITENAME }}{% endif %}" />
    <meta property="og:description" content="{{ meta_description_long }}" />
    <meta property="og:url" content="{{ SITEURL }}/{% if article %}{{ article.url }}{% elif page %}{{ page.url }}{% endif %}" />
    
    <!-- Social Share Plugin Images (priority) -->
    {% if article and article.metadata.social_image %}
    <meta property="og:image" content="{{ SITEURL }}{{ article.metadata.social_image }}" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="675" />
    {% elif page and page.metadata.social_image %}
    <meta property="og:image" content="{{ SITEURL }}{{ page.metadata.social_image }}" />
    <meta property="og:image:type" content="image/png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="675" />
    <!-- Fallback to existing SEO setup -->
    {% elif article and article.og_image %}
    <meta property="og:image" content="{{ SITEURL }}/static/{{ article.og_image }}" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    {% elif SEO.og_image %}
    <meta property="og:image" content="{{ SITEURL }}/static/{{ SEO.og_image }}" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    {% endif %}

    <!-- Twitter Card Meta Tags -->
    {% if SEO.twitter_username %}
    <meta name="twitter:creator" content="@{{ SEO.twitter_username }}" />
    {% endif %}
    <meta name="twitter:title" content="{% if article %}{{ article.title }}{% elif page %}{{ page.title }}{% else %}{{ SITENAME }}{% endif %}" />
    <meta name="twitter:description" content="{{ meta_description_long }}" />
    
    <!-- Twitter Card Image (follows same priority as OG) -->
    {% if article and article.metadata.social_image %}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="{{ SITEURL }}{{ article.metadata.social_image }}" />
    {% elif page and page.metadata.social_image %}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="{{ SITEURL }}{{ page.metadata.social_image }}" />
    {% elif article and article.og_image %}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="{{ SITEURL }}/static/{{ article.og_image }}" />
    {% elif SEO.og_image %}
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="{{ SITEURL }}/static/{{ SEO.og_image }}" />
    {% else %}
    <meta name="twitter:card" content="summary" />
    {% endif %}
    
    <link rel="icon" type="image/x-icon" href="/theme/images/favicon.ico">
    <link rel="preload" href="/theme/css/pico.min.css" as="style">
    <link rel="stylesheet" href="/theme/css/pico.min.css">
    {% if NLWEB_CHAT_ENABLED and NLWEB_CHAT_CSS_URL %}
    <link rel="stylesheet" href="{{ NLWEB_CHAT_CSS_URL }}">
    {% endif %}
    
    <style>
    /* Inline critical CSS for better performance */
    a {
        text-decoration: none;
    }

    .responsive-image {
        max-width: 100%;
        height: auto;
    }

    .portrait-image {
        max-height: none;
    }

    @media (max-width: 768px) {
        .portrait-image {
            max-height: 60vh;
        }
    }

    .article-list {
        list-style: none !important;
        padding: 0 !important;
        margin: 0 !important;
    }

    .article-list li {
        list-style: none !important;
        margin-bottom: 1.5rem;
    }

    h1 {
        font-size: 2rem;
    }

    .show-on-mobile {
        display: none;
    }

    @media (max-width: 768px) {
        .hide-on-mobile {
            display: none;
        }
        
        .show-on-mobile {
            display: block;
        }
    }

    .dropdown ul {
        border: 1px solid var(--muted-border-color);
        box-shadow: var(--card-box-shadow);
    }

    footer {
        background-color: var(--pico-card-background-color);
        border-top: var(--pico-border-width) solid var(--pico-muted-border-color);
        margin-top: var(--pico-block-spacing-vertical);
    }

    .grid-page {
        display: grid;
        gap: var(--pico-block-spacing-vertical);
    }

    .grid-page__header {
        display: grid;
        gap: var(--pico-spacing);
        margin-bottom: var(--pico-block-spacing-vertical);
    }

    .card-grid {
        display: grid;
        grid-template-columns: repeat(var(--card-grid-columns, 3), minmax(0, 1fr));
        gap: var(--pico-block-spacing-horizontal);
        align-items: stretch;
    }

    @media (max-width: 900px) {
        .card-grid {
            grid-template-columns: repeat(auto-fit, minmax(14rem, 1fr));
        }
    }

    .card-grid__item {
        background-color: var(--pico-card-background-color);
        border: var(--pico-border-width) solid var(--pico-muted-border-color);
        border-radius: var(--pico-border-radius);
        box-shadow: var(--card-box-shadow);
        height: 100%;
        overflow: hidden;
    }

    .card-grid__link {
        display: flex;
        gap: var(--pico-spacing);
        color: inherit;
        padding: var(--pico-block-spacing-horizontal);
        height: 100%;
        align-items: flex-start;
    }

    .card-grid__icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 999px;
        background-color: var(--pico-muted-border-color);
        color: var(--pico-muted-color);
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .card-grid__body {
        display: grid;
        gap: calc(var(--pico-spacing) / 2);
    }

    .card-grid__title {
        margin: 0;
        font-size: 1.1rem;
    }

    .card-grid__summary {
        margin: 0;
        color: var(--pico-muted-color);
    }
        {% if NLWEB_CHAT_ENABLED %}
        /* NLWeb chat: Pico theme styling for all sections */
        .nlweb-dropdown-container {
            background-color: var(--pico-background-color);
        }
        .nlweb-dropdown-input,
        .nlweb-dropdown-input input {
            background-color: var(--pico-form-element-background-color);
            color: var(--pico-form-element-color);
            border-color: var(--pico-border-color);
        }
        .nlweb-dropdown-results {
            background-color: var(--pico-form-element-background-color);
        }
        .item-container {
            background-color: var(--pico-background-color);
            border-color: var(--pico-border-color);
        }
        .nlweb-dropdown-chat-input-container {
            background-color: var(--pico-form-element-background-color);
            border-color: var(--pico-border-color);
        }
        .nlweb-dropdown-chat-input-wrapper,
        .nlweb-dropdown-chat-input-box {
            background-color: var(--pico-form-element-background-color);
        }
        .nlweb-dropdown-chat-input,
        .nlweb-dropdown-chat-input textarea {
            background-color: var(--pico-form-element-background-color);
            color: var(--pico-form-element-color);
            border-color: var(--pico-border-color);
        }
        .nlweb-dropdown-response,
        .nlweb-dropdown-response input {
            background-color: var(--pico-background-color);
            color: var(--pico-form-element-color);
            border-color: var(--pico-border-color);
        }
        {% endif %}
    {% if NLWEB_CHAT_ENABLED and NLWEB_CHAT_STYLE_MODE == "scoped" %}
    /* NLWeb chat: scoped reset to avoid Pico overrides */
    .nlweb-dropdown-container,
    .nlweb-dropdown-container * {
        all: revert;
        box-sizing: border-box;
    }
    {% endif %}
    </style>
    {% endblock head %}
</head>
<body{% block body_class %}{% endblock %}>
    {% block navbar %}{% include 'navbar.html' %}{% endblock %}
    <!-- Content -->
    <main>
        <section id="index">
            <div class="container">
                {% block content %}{% endblock %}
            </div>
        </section>
        {% if NLWEB_CHAT_ENABLED %}
        <div id="{{ NLWEB_CHAT_CONTAINER_ID }}"></div>
        <script type="module">
            import { NLWebDropdownChat } from '{{ NLWEB_CHAT_MODULE_URL }}';

            const chat = new NLWebDropdownChat({
                containerId: '{{ NLWEB_CHAT_CONTAINER_ID }}',
                site: '{{ NLWEB_CHAT_SITE }}',
                placeholder: '{{ NLWEB_CHAT_PLACEHOLDER }}',
                endpoint: '{{ NLWEB_CHAT_ENDPOINT }}'
            });
        </script>
        {% endif %}
    </main>
    {% include 'footer.html' %}
</body>
</html>
